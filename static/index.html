<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>nest-vue-chat</title>
  <link rel="stylesheet" href="./styles.css">
  <link href="https://unpkg.com/vue-simple-notify/dist/vue-simple-notify.min.css">
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="https://unpkg.com/vue-simple-notify/dist/vue-simple-notify.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>

</head>
<body>
  <div id="v-app">
    <section class="alerts">
      <alerts-component></alerts-component>
    </section>
    <section class="chat">
      <h1>{{title}}</h1>
      <ul>
        <li v-for="(msg, index) in messages" :key="index+msg.message">
          <strong>{{msg.sender}}</strong> {{msg.message}}</li>
      </ul>
      <form>
        <input type="text" placeholder="Enter your message..." v-model="text">
        <button type="submit" @click.prevent="sendChatMessage">Send message</button>
      </form>
    </section>
  </div>
  <script>
    Vue.component('slerts-component', VueSimpleNotify.VueSimpleNotify)
    const app = new Vue({
      el:'#v-app',
      data:{
        title:'Websockets testing',
        username:'',
        text:'',
        messages:[],
        socket: { chat:null, alert:null },
        alerts:[]
      },
      methods:{
        sendChatMessage(){
          this.socket.chat.emit('chatToServer', { sender: this.username, message: this.text })
          this.text=''
        },
        recieveChatMessage(msg){
          this.messages.push(msg)
        },
        recieveAlertMessage(msg){
          this.alerts.push(msg)
        }
      },
      created(){
        this.username = prompt("Enter your username")
        this.socket.chat= io('http://localhost:3000/chat')
        this.socket.chat.on('chatToClient', (msg)=>{
          this.recieveChatMessage(msg)
        })

        this.socket.alerts = io('http://localhost:3000/alert')
        this.socket.alerts.on('alertToClient', (msg)=>{
          this.recieveAlertMessage(msg)
        })
      }
    })
  </script>
</body>

</html>